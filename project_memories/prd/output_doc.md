# PRD: Output System Documentation

**Date:** 2025-07-03
**Author:** Gemini

## 1. Executive Summary

This document provides a comprehensive overview of the consolidated output management system for the Tiger-Monkey project. The system is designed to be robust, predictable, and easy to manage, with a clear separation of outputs for different environments (development, production, and testing). This guide explains the directory structure, the role of the `OutputManager`, and how to control where files are written.

## 2. Centralized Output Directory Structure

All files generated by the Tiger and Monkey services are now stored in a single, top-level `/outputs` directory. This centralized location prevents confusion and makes it easy to locate, manage, and clean up generated files.

The structure is as follows:

```
/outputs/
├── tiger/
│   ├── production/
│   ├── development/
│   └── testing/
├── monkey/
│   ├── production/
│   ├── development/
│   └── testing/
└── tests/
```

*   `/outputs/tiger/`: Contains all files generated by the Tiger service.
*   `/outputs/monkey/`: Contains all files generated by the Monkey service.
*   `/outputs/tests/`: Reserved for the outputs of integration and end-to-end tests.

## 3. The `OutputManager` Class

The `OutputManager` class is the core component responsible for all file I/O operations. Both the Tiger and Monkey services have their own `OutputManager` tailored to their specific needs, but they share the same fundamental design.

The key responsibilities of the `OutputManager` are:

*   **Directory Management:** It automatically creates the necessary subdirectories (`processed`, `failed`, `metadata`, etc.) within the correct environment folder.
*   **File Saving:** It handles the saving of all generated files, including documents, reports, and metadata.
*   **Versioning:** It provides a versioning system to prevent accidental overwrites of existing files.

## 4. Controlling Output Environments

The primary mechanism for controlling where files are written is the `environment` parameter in the `OutputManager`'s constructor. This parameter determines which subdirectory (`development`, `production`, or `testing`) will be used as the base for all output operations.

### 4.1. How It Works

Here is the relevant code snippet from the `OutputManager`'s `__init__` method in both services:

```python
# In both tiger/app/output/handlers.py and monkey/core/output_manager.py

def __init__(self, environment: str = "testing"):
    # The service name ('tiger' or 'monkey') is now part of the path
    self.base_path = Path("outputs") / "<service_name>" / environment
    self.processed_path = self.base_path / "processed"
    self.failed_path = self.base_path / "failed"
    self.reports_path = self.base_path / "reports"
    self.metadata_path = self.base_path / "metadata"
    self._setup_directories()
    self.logger = logging.getLogger(__name__)
```

When an `OutputManager` is instantiated, it constructs its base path using the provided `environment`. For example:

*   `OutputManager(environment="production")` will write files to `/outputs/<service_name>/production/`.
*   `OutputManager(environment="development")` will write files to `/outputs/<service_name>/development/`.
*   `OutputManager()` (with no arguments) will default to the `testing` environment and write to `/outputs/<service_name>/testing/`.

### 4.2. Usage in the CLI

The command-line interface for each service can be extended to include an `--env` or similar flag. This flag would then be passed to the `OutputManager` to control the output directory.

**Example (hypothetical):**

```bash
# Process a document and save the output to the production directory
./satori-tiger process document.pdf --env production

# Generate a document and save it to the development directory
./satori-monkey build-complaint complaint.json --env development
```

## 5. Benefits of the Consolidated System

This new, centralized output system offers several key advantages:

*   **Clarity:** There is a single, unambiguous location for all generated files.
*   **Simplicity:** The logic for managing outputs is consolidated into a single class for each service.
*   **Safety:** The separation of environments prevents accidental overwrites of production data by development or testing processes.
*   **Ease of Management:** The entire `/outputs` directory can be easily backed up, cleaned, or archived as a single unit. It is also ignored by Git, which prevents generated files from being accidentally committed to the repository.

This robust and well-defined system provides a solid foundation for the project's future growth and development.
