<!DOCTYPE html>
<html lang="en" class="bg-gray-50">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iCloud Configuration - Satori AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/themes/light/css/style.css?v=2.0.0&t=20250714-182000">
    <link rel="stylesheet" href="/static/icloud/icloud.css?v=2.0.0">
    <script>
        const SATORI_VERSION = "2.0.0";  // Updated for version control standardization
    </script>
</head>
<body class="bg-gray-50">

    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center">
                        <svg class="h-6 w-6 text-blue-600 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15a4.5 4.5 0 0 0 4.5 4.5H18a3.75 3.75 0 0 0 1.332-7.257 3 3 0 0 0-3.758-3.848 5.25 5.25 0 0 0-10.233 2.33A4.502 4.502 0 0 0 2.25 15Z" />
                        </svg>
                        <h1 class="text-xl font-bold text-gray-900">iCloud Configuration</h1>
                    </div>
                    <a href="/" class="text-sm font-medium text-blue-600 hover:underline">&larr; Back to Dashboard</a>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- iCloud Configuration -->
            <div class="bg-white rounded-lg shadow-sm">
                <!-- Page Header -->
                <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900">iCloud Integration</h2>
                            <p class="text-gray-600 mt-1">Configure iCloud sync settings and download the Go adapter package.</p>
                        </div>
                        <div class="flex space-x-3">
                            <button id="test-connection-btn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <svg class="h-4 w-4 inline-block mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.34 15.84c-.688-.06-1.386-.09-2.09-.09H7.5a4.5 4.5 0 1 1 0-9h.75c.704 0 1.402-.03 2.09-.09m0 9.18c.253.962.584 1.892.985 2.783.247.55.06 1.21-.463 1.511l-.657.38c-.551.318-1.26.117-1.527-.461a20.845 20.845 0 0 1-1.44-4.282m3.102.069a18.03 18.03 0 0 1-.59-4.59c0-1.586.205-3.124.59-4.59m0 9.18a23.848 23.848 0 0 1 8.835 2.535M10.34 6.66a23.847 23.847 0 0 0 8.835-2.535m0 0A23.74 23.74 0 0 0 18.795 3m.38 1.125a23.91 23.91 0 0 1 1.014 5.395m-1.014 8.855c-.118.38-.245.754-.38 1.125m.38-1.125a23.91 23.91 0 0 0 1.014-5.395m0-3.46c.495.413.811 1.035.811 1.73 0 .695-.316 1.317-.811 1.73m0-3.46a24.347 24.347 0 0 1 0 3.46" />
                                </svg>
                                Test Connection
                            </button>
                            <button id="save-config-btn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500">
                                <svg class="h-4 w-4 inline-block mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                                </svg>
                                Save Configuration
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Configuration Content -->
                <div class="p-6 space-y-8">
                    <!-- Security Notice -->
                    <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
                        <div class="flex items-start space-x-3">
                            <svg class="h-5 w-5 text-amber-600 mt-0.5 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75m-3.75 5.25a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                            </svg>
                            <div class="flex-1">
                                <h4 class="text-sm font-medium text-amber-900 mb-1">Secure Configuration</h4>
                                <p class="text-sm text-amber-800">iCloud credentials are encrypted and stored locally. The sync adapter only accesses your designated case files folder and does not have access to any other iCloud data.</p>
                            </div>
                        </div>
                    </div>

                    <!-- iCloud Configuration Form -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- iCloud Parent Folder -->
                        <div class="lg:col-span-2">
                            <label for="icloud-folder" class="block text-sm font-medium text-gray-700 mb-2">
                                iCloud Parent Folder Name <span class="text-red-500">*</span>
                            </label>
                            <input type="text" 
                                   id="icloud-folder" 
                                   name="icloud-folder"
                                   placeholder="CASES"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   required>
                            <p class="text-xs text-gray-500 mt-1">The folder name in iCloud Drive where all case folders are stored (e.g., CASES, ClientFiles)</p>
                        </div>

                        <!-- Sync Interval -->
                        <div>
                            <label for="sync-interval" class="block text-sm font-medium text-gray-700 mb-2">
                                Sync Interval (seconds)
                            </label>
                            <input type="number" 
                                   id="sync-interval" 
                                   name="sync-interval"
                                   value="30"
                                   min="10"
                                   max="300"
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <p class="text-xs text-gray-500 mt-1">How often to check for new files (10-300 seconds)</p>
                        </div>

                        <!-- Log Level -->
                        <div>
                            <label for="log-level" class="block text-sm font-medium text-gray-700 mb-2">
                                Log Level
                            </label>
                            <select id="log-level" 
                                    name="log-level"
                                    class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="info">Info</option>
                                <option value="debug">Debug</option>
                                <option value="warning">Warning</option>
                                <option value="error">Error</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-1">Logging verbosity level for sync operations</p>
                        </div>

                        <!-- Backup Enabled -->
                        <div class="lg:col-span-2">
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" 
                                       id="backup-enabled" 
                                       name="backup-enabled"
                                       class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <label for="backup-enabled" class="text-sm font-medium text-gray-700">
                                    Enable Local Backup
                                </label>
                            </div>
                            <p class="text-xs text-gray-500 mt-1 ml-7">Create local backups of synced files before processing</p>
                        </div>
                    </div>

                    <!-- Status Dashboard -->
                    <div class="border-t border-gray-200 pt-8">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="h-5 w-5 text-blue-600 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 14.25v2.25m3-4.5v4.5m3-6.75v6.75m3-9v9M6 20.25h12A2.25 2.25 0 0 0 20.25 18V6A2.25 2.25 0 0 0 18 3.75H6A2.25 2.25 0 0 0 3.75 6v12A2.25 2.25 0 0 0 6 20.25Z" />
                            </svg>
                            Sync Adapter Status
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <!-- Connection Status -->
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-900">Connection Status</h4>
                                        <p id="connection-status" class="text-sm text-gray-500">Not configured</p>
                                    </div>
                                    <div id="connection-indicator" class="h-3 w-3 rounded-full bg-gray-400"></div>
                                </div>
                            </div>

                            <!-- Last Sync -->
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-900">Last Sync</h4>
                                        <p id="last-sync" class="text-sm text-gray-500">Never</p>
                                    </div>
                                    <svg class="h-4 w-4 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                                    </svg>
                                </div>
                            </div>

                            <!-- Files Synced -->
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-900">Files Synced</h4>
                                        <p id="files-synced" class="text-sm text-gray-500">0</p>
                                    </div>
                                    <svg class="h-4 w-4 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-4.5a1.125 1.125 0 0 1-1.125-1.125v-1.5A3.375 3.375 0 0 0 7.125 2.25H4.875C3.839 2.25 3 3.089 3 4.125v15.75c0 1.036.839 1.875 1.875 1.875h11.25c1.036 0 1.875-.839 1.875-1.875v-8.688a3.375 3.375 0 0 0-.621-1.943l-2.343-3.129a1.406 1.406 0 0 0-1.134-.564H12a.75.75 0 0 1 0-1.5h1.875A2.906 2.906 0 0 1 16.19 5.47l2.343 3.129A4.875 4.875 0 0 1 19.5 11.25Z" />
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Download Section -->
                    <div class="border-t border-gray-200 pt-8">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="h-5 w-5 text-blue-600 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
                            </svg>
                            Download Go Sync Adapter
                        </h3>
                        
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                            <div class="flex items-start space-x-4">
                                <div class="flex-shrink-0">
                                    <svg class="h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" />
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <h4 class="text-lg font-medium text-blue-900 mb-2">Configured Sync Adapter Package</h4>
                                    <p class="text-sm text-blue-800 mb-4">Download the Go-based sync adapter pre-configured with your iCloud settings. This package includes the compiled binary and configuration files needed to sync case files from iCloud Drive to your local TM system.</p>
                                    
                                    <div class="space-y-3">
                                        <div class="flex items-center space-x-2 text-sm text-blue-700">
                                            <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75m-3.75 5.25a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                                            </svg>
                                            <span>Cross-platform compatibility (macOS, Linux, Windows)</span>
                                        </div>
                                        <div class="flex items-center space-x-2 text-sm text-blue-700">
                                            <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75m-3.75 5.25a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                                            </svg>
                                            <span>Automatic file detection and sync</span>
                                        </div>
                                        <div class="flex items-center space-x-2 text-sm text-blue-700">
                                            <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75m-3.75 5.25a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                                            </svg>
                                            <span>Secure encrypted credential storage</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-6 flex items-center justify-between">
                                <div class="text-sm text-blue-700">
                                    <p class="font-medium">Package includes:</p>
                                    <ul class="mt-1 space-y-1 text-xs">
                                        <li>• icloud-sync executable</li>
                                        <li>• Configuration files</li>
                                        <li>• Setup instructions</li>
                                        <li>• Service installation scripts</li>
                                    </ul>
                                </div>
                                <button id="download-package-btn" class="px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 flex items-center space-x-2">
                                    <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
                                    </svg>
                                    <span>Download Package</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Instructions Section -->
                    <div class="border-t border-gray-200 pt-8">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="h-5 w-5 text-blue-600 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 0 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 1-6 2.292m0-14.25v14.25" />
                            </svg>
                            Setup Instructions
                        </h3>
                        
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                            <div class="prose prose-sm max-w-none">
                                <h4 class="text-base font-medium text-gray-900 mb-3">Getting Started</h4>
                                <ol class="space-y-2 text-sm text-gray-700">
                                    <li class="flex items-start">
                                        <span class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-medium mr-3 mt-0.5">1</span>
                                        <span>Configure your iCloud settings above and save the configuration</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-medium mr-3 mt-0.5">2</span>
                                        <span>Test the connection to verify your iCloud credentials are working</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-medium mr-3 mt-0.5">3</span>
                                        <span>Download the configured sync adapter package</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-medium mr-3 mt-0.5">4</span>
                                        <span>Extract the package and run the installation script on your server</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-medium mr-3 mt-0.5">5</span>
                                        <span>The sync adapter will automatically start monitoring your iCloud folder</span>
                                    </li>
                                </ol>
                                
                                <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                    <h5 class="text-sm font-medium text-blue-900 mb-2">Important Notes</h5>
                                    <ul class="text-xs text-blue-800 space-y-1">
                                        <li>• Ensure your iCloud account has two-factor authentication enabled</li>
                                        <li>• Use an app-specific password instead of your main iCloud password</li>
                                        <li>• The sync adapter runs as a background service and monitors for changes</li>
                                        <li>• Files are synced to the test-data/sync-test-cases/ directory</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Success/Error Messages -->
                <div id="icloud-messages" class="hidden px-6 py-4 border-t border-gray-200">
                    <!-- Messages will be inserted here by JavaScript -->
                </div>
            </div>
        </main>
    </div>

    <script src="/static/icloud/icloud.js?v=2.0.0"></script>
</body>
</html>